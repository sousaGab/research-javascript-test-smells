file,type,line,method,source
/test/morgan.js,IdenticalTestDescription,"{'startLine':350,'endLine':370}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':802,'endLine':821}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':823,'endLine':837}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':839,'endLine':853}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':855,'endLine':869}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':903,'endLine':922}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':924,'endLine':943}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':945,'endLine':972}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':1013,'endLine':1025}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':1154,'endLine':1170}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':1174,'endLine':1192}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':1340,'endLine':1356}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",snuts
/test/morgan.js,IdenticalTestDescription,"{'startLine':1360,'endLine':1375}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':17,'endLine':17}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':35,'endLine':35}","it('should accept format as format name', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(/^GET \/ 200 - - \d+\.\d{3} ms$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':51,'endLine':51}","it('should accept format as format string', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':67,'endLine':67}","it('should accept format as function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':92,'endLine':92}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':109,'endLine':109}","it('should accept format in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'GET /')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ format: ':method :url', stream: stream }))
            .get('/')
            .expect(200, cb)
        })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':125,'endLine':125}","it('should accept format function in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'apple')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          function format () {
            return 'apple'
          }

          request(createServer({ format: format, stream: stream }))
            .get('/')
            .expect(200, cb)
        })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':158,'endLine':158}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':179,'endLine':179}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':200,'endLine':200}","it('should get current date in ""web"" format by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':216,'endLine':216}","it('should get current date in ""clf"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[clf]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':232,'endLine':232}","it('should get current date in ""iso"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[iso]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':248,'endLine':248}","it('should get current date in ""web"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[web]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':264,'endLine':264}","it('should be blank for unknown format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[bogus]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':282,'endLine':282}","it('should be 1.0 or 1.1', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^1\.[01]$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':http-version', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':300,'endLine':300}","it('should get request properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'me')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[x-from-string]', { stream: stream }))
          .get('/')
          .set('x-from-string', 'me')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':317,'endLine':317}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo=bar, fizz=buzz')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[set-cookie]', { stream: stream }))
          .get('/')
          .set('Set-Cookie', ['foo=bar', 'fizz=buzz'])
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':336,'endLine':336}","it('should get response properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'true')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':res[x-sent]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':352,'endLine':352}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':376,'endLine':376}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':393,'endLine':393}","it('should use req.ip if there', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          req.ip = '10.0.0.1'
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':413,'endLine':413}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':433,'endLine':433}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':451,'endLine':451}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':476,'endLine':476}","it('should work when req.ip is a getter', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          Object.defineProperty(req, 'ip', {
            get: function () { return req.connection.remoteAddress ? '10.0.0.1' : undefined }
          })
        })

        request(server)
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':499,'endLine':499}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':525,'endLine':525}","it('should be empty if none present', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':541,'endLine':541}","it('should support Basic authorization', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'tj')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':558,'endLine':558}","it('should be empty for empty Basic authorization user', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic Og==')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':577,'endLine':577}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':598,'endLine':598}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':614,'endLine':614}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':630,'endLine':630}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':646,'endLine':646}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':678,'endLine':678}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':699,'endLine':699}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':720,'endLine':720}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':751,'endLine':751}","it('should get response status', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, String(res.statusCode))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':status', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':767,'endLine':767}","it('should not exist before response sent', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':status', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':804,'endLine':804}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':825,'endLine':825}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':841,'endLine':841}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':857,'endLine':857}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':873,'endLine':873}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':905,'endLine':905}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':926,'endLine':926}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':947,'endLine':947}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':978,'endLine':978}","it('should get request URL', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/foo')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':url', { stream: stream }))
          .get('/foo')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':994,'endLine':994}","it('should use req.originalUrl if exists', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':url', { stream: stream }, function (req, res, next) {
          req.originalUrl = '/bar'
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1033,'endLine':1033}","it('should log result of function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1083,'endLine':1083}","it('should accept format as format string of tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1099,'endLine':1099}","it('should accept text mixed with tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'method=GET url=/')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('method=:method url=:url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1115,'endLine':1115}","it('should accept special characters', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'LOCAL\\tobi ""GET /"" 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('LOCAL\\:remote-user "":method :url"" :status', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dG9iaTpsb2tp')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1134,'endLine':1134}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('combined', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1156,'endLine':1156}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1176,'endLine':1176}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1198,'endLine':1198}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1216,'endLine':1222}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1229,'endLine':1229}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1251,'endLine':1251}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1273,'endLine':1273}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1295,'endLine':1295}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1318,'endLine':1318}","it('should not have color or response values', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, '_color_0_GET / _color_0_-_color_0_ - ms - -_color_0_')
            done()
          })

          var stream = createColorLineStream(function onLine (line) {
            cb(null, null, line)
          })

          var server = createServer('dev', {
            immediate: true,
            stream: stream
          })

          request(server)
            .get('/')
            .expect(200, cb)
        })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1342,'endLine':1342}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1362,'endLine':1362}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1382,'endLine':1382}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1401,'endLine':1401}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1410,'endLine':1410}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1429,'endLine':1429}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1440,'endLine':1440}","it('should not have value for :res', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1461,'endLine':1461}","it('should not have value for :response-time', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :response-time', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1482,'endLine':1482}","it('should not have value for :status', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :status', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",snuts
/test/morgan.js,ConditionalTestLogic,"{'startLine':1504,'endLine':1504}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",snuts
/test/morgan.js,NonFunctionalStatement,"{'startLine':1565,'endLine':1565}","it('should reject functions', function () {
        assert.throws(morgan.compile.bind(morgan, function () {}), /argument format/)
      })",snuts
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 18}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 19}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 12, 'line': 93}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Assertion Roulette,"{'column': 12, 'line': 94}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 159}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 160}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 180}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 181}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 377}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 378}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 414}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 415}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 434}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 435}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 452}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 453}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 500}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 501}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 580}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 581}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 649}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 650}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 651}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 807}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 808}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 876}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 877}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 878}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1199}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1200}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1230}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1231}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1252}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1253}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1274}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1275}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1296}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 10, 'line': 1297}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1383}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1384}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1385}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1411}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1412}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1413}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1505}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1515}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1574}","it('should compile a string into a function', function () {
        var fn = morgan.compile(':method')
        assert.ok(typeof fn === 'function')
        assert.ok(fn.length === 3)
      })",steel
/test/morgan.js,Assertion Roulette,"{'column': 8, 'line': 1575}","it('should compile a string into a function', function () {
        var fn = morgan.compile(':method')
        assert.ok(typeof fn === 'function')
        assert.ok(fn.length === 3)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 17, 'column': 8, 'index': 461}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 35, 'column': 10, 'index': 988}","it('should accept format as format name', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(/^GET \/ 200 - - \d+\.\d{3} ms$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 51, 'column': 10, 'index': 1451}","it('should accept format as format string', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 67, 'column': 10, 'index': 1899}","it('should accept format as function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 92, 'column': 12, 'index': 2647}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 109, 'column': 12, 'index': 3188}","it('should accept format in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'GET /')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ format: ':method :url', stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 125, 'column': 12, 'index': 3694}","it('should accept format function in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'apple')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          function format () {
            return 'apple'
          }

          request(createServer({ format: format, stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 158, 'column': 10, 'index': 4495}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 179, 'column': 10, 'index': 5096}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 200, 'column': 10, 'index': 5706}","it('should get current date in ""web"" format by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 216, 'column': 10, 'index': 6193}","it('should get current date in ""clf"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[clf]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 232, 'column': 10, 'index': 6683}","it('should get current date in ""iso"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[iso]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 248, 'column': 10, 'index': 7175}","it('should get current date in ""web"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[web]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 264, 'column': 10, 'index': 7662}","it('should be blank for unknown format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[bogus]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 282, 'column': 10, 'index': 8145}","it('should be 1.0 or 1.1', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^1\.[01]$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':http-version', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 300, 'column': 10, 'index': 8633}","it('should get request properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'me')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[x-from-string]', { stream: stream }))
          .get('/')
          .set('x-from-string', 'me')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 317, 'column': 10, 'index': 9133}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo=bar, fizz=buzz')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[set-cookie]', { stream: stream }))
          .get('/')
          .set('Set-Cookie', ['foo=bar', 'fizz=buzz'])
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 336, 'column': 10, 'index': 9693}","it('should get response properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'true')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':res[x-sent]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 352, 'column': 10, 'index': 10150}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 376, 'column': 10, 'index': 10819}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 393, 'column': 10, 'index': 11303}","it('should use req.ip if there', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          req.ip = '10.0.0.1'
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 413, 'column': 10, 'index': 11842}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 433, 'column': 10, 'index': 12396}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 451, 'column': 10, 'index': 12931}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 476, 'column': 10, 'index': 13649}","it('should work when req.ip is a getter', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          Object.defineProperty(req, 'ip', {
            get: function () { return req.connection.remoteAddress ? '10.0.0.1' : undefined }
          })
        })

        request(server)
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 499, 'column': 10, 'index': 14362}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 525, 'column': 10, 'index': 15100}","it('should be empty if none present', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 541, 'column': 10, 'index': 15546}","it('should support Basic authorization', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'tj')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 558, 'column': 10, 'index': 16055}","it('should be empty for empty Basic authorization user', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic Og==')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 577, 'column': 10, 'index': 16590}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 598, 'column': 10, 'index': 17162}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 614, 'column': 10, 'index': 17630}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 630, 'column': 10, 'index': 18099}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 646, 'column': 10, 'index': 18557}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 678, 'column': 10, 'index': 19404}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 699, 'column': 10, 'index': 19964}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 720, 'column': 10, 'index': 20505}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 751, 'column': 10, 'index': 21237}","it('should get response status', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, String(res.statusCode))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':status', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 767, 'column': 10, 'index': 21700}","it('should not exist before response sent', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':status', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 804, 'column': 10, 'index': 22652}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 825, 'column': 10, 'index': 23221}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 841, 'column': 10, 'index': 23686}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 857, 'column': 10, 'index': 24152}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 873, 'column': 10, 'index': 24603}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 905, 'column': 10, 'index': 25447}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 926, 'column': 10, 'index': 26004}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 947, 'column': 10, 'index': 26542}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 978, 'column': 10, 'index': 27264}","it('should get request URL', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/foo')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':url', { stream: stream }))
          .get('/foo')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 994, 'column': 10, 'index': 27710}","it('should use req.originalUrl if exists', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':url', { stream: stream }, function (req, res, next) {
          req.originalUrl = '/bar'
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1033, 'column': 10, 'index': 28752}","it('should log result of function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1083, 'column': 10, 'index': 30126}","it('should accept format as format string of tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1099, 'column': 10, 'index': 30578}","it('should accept text mixed with tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'method=GET url=/')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('method=:method url=:url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1115, 'column': 10, 'index': 31048}","it('should accept special characters', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'LOCAL\\tobi ""GET /"" 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('LOCAL\\:remote-user "":method :url"" :status', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dG9iaTpsb2tp')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1134, 'column': 10, 'index': 31637}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('combined', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1156, 'column': 10, 'index': 32426}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1176, 'column': 10, 'index': 33101}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1198, 'column': 10, 'index': 33869}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1216, 'column': 12, 'index': 34433}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1229, 'column': 10, 'index': 34915}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1251, 'column': 10, 'index': 35576}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1273, 'column': 10, 'index': 36238}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1295, 'column': 10, 'index': 36898}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1318, 'column': 12, 'index': 37646}","it('should not have color or response values', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, '_color_0_GET / _color_0_-_color_0_ - ms - -_color_0_')
            done()
          })

          var stream = createColorLineStream(function onLine (line) {
            cb(null, null, line)
          })

          var server = createServer('dev', {
            immediate: true,
            stream: stream
          })

          request(server)
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1342, 'column': 10, 'index': 38291}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1362, 'column': 10, 'index': 38919}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1382, 'column': 8, 'index': 39490}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1401, 'column': 10, 'index': 39999}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1410, 'column': 8, 'index': 40242}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1429, 'column': 10, 'index': 40748}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1440, 'column': 8, 'index': 41048}","it('should not have value for :res', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1461, 'column': 8, 'index': 41559}","it('should not have value for :response-time', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :response-time', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1482, 'column': 8, 'index': 42065}","it('should not have value for :status', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :status', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1504, 'column': 8, 'index': 42586}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Conditional Test Logic,"{'line': 1592, 'column': 4, 'index': 44954}",Unknown,steel
/test/morgan.js,Conditional Test Logic,"{'line': 1614, 'column': 4, 'index': 45444}",Unknown,steel
/test/morgan.js,Conditional Test Logic,"{'line': 1621, 'column': 8, 'index': 45615}",Unknown,steel
/test/morgan.js,Exception Handling,"{'line': 1053, 'column': 10, 'index': 29318}","it('should not log for undefined return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return undefined
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Exception Handling,"{'line': 1067, 'column': 10, 'index': 29692}","it('should not log for null return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return null
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Exception Handling,"{'line': 1528, 'column': 8, 'index': 43230}","it('should be able to skip based on request', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req) {
        return req.url.indexOf('skip=true') !== -1
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/?skip=true')
        .set('Connection', 'close')
        .expect(200, done)
    })",steel
/test/morgan.js,Exception Handling,"{'line': 1543, 'column': 8, 'index': 43672}","it('should be able to skip based on response', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req, res) {
        return res.statusCode === 200
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/')
        .expect(200, done)
    })",steel
/test/morgan.js,Global Variable,"{'line': 16, 'column': 6, 'index': 407}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 23, 'column': 6, 'index': 624}","it('should use default format', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert(res.text.length > 0)
        assert.strictEqual(line.substr(0, res.text.length), res.text)
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      request(createServer(undefined, { stream: stream }))
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 34, 'column': 8, 'index': 932}","it('should accept format as format name', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(/^GET \/ 200 - - \d+\.\d{3} ms$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 40, 'column': 8, 'index': 1113}","it('should accept format as format name', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(/^GET \/ 200 - - \d+\.\d{3} ms$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 50, 'column': 8, 'index': 1395}","it('should accept format as format string', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 56, 'column': 8, 'index': 1558}","it('should accept format as format string', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 66, 'column': 8, 'index': 1843}","it('should accept format as function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 72, 'column': 8, 'index': 2010}","it('should accept format as function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 91, 'column': 10, 'index': 2589}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 98, 'column': 10, 'index': 2830}","it('should accept options object', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert(res.text.length > 0)
            assert.strictEqual(line.substr(0, res.text.length), res.text)
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 108, 'column': 10, 'index': 3130}","it('should accept format in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'GET /')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ format: ':method :url', stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 114, 'column': 10, 'index': 3303}","it('should accept format in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'GET /')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          request(createServer({ format: ':method :url', stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 124, 'column': 10, 'index': 3636}","it('should accept format function in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'apple')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          function format () {
            return 'apple'
          }

          request(createServer({ format: format, stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 130, 'column': 10, 'index': 3809}","it('should accept format function in options for back-compat', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, 'apple')
            done()
          })

          var stream = createLineStream(function (line) {
            cb(null, null, line)
          })

          function format () {
            return 'apple'
          }

          request(createServer({ format: format, stream: stream }))
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 157, 'column': 8, 'index': 4439}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 164, 'column': 8, 'index': 4668}","it('should default to process.stdout', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        Object.defineProperty(process, 'stdout', {
          value: stream
        })

        request(createServer(undefined, { stream: undefined }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 178, 'column': 8, 'index': 5040}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 185, 'column': 8, 'index': 5269}","it('should set stream to write logs to', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert(res.text.length > 0)
          assert.strictEqual(line.substr(0, res.text.length), res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(undefined, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 199, 'column': 8, 'index': 5650}","it('should get current date in ""web"" format by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 205, 'column': 8, 'index': 5852}","it('should get current date in ""web"" format by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 215, 'column': 8, 'index': 6137}","it('should get current date in ""clf"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[clf]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 221, 'column': 8, 'index': 6337}","it('should get current date in ""clf"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[clf]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 231, 'column': 8, 'index': 6627}","it('should get current date in ""iso"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[iso]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 237, 'column': 8, 'index': 6829}","it('should get current date in ""iso"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[iso]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 247, 'column': 8, 'index': 7119}","it('should get current date in ""web"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[web]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 253, 'column': 8, 'index': 7321}","it('should get current date in ""web"" format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^\w{3}, \d{2} \w{3} \d{4} \d{2}:\d{2}:\d{2} GMT$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[web]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 263, 'column': 8, 'index': 7606}","it('should be blank for unknown format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[bogus]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 269, 'column': 8, 'index': 7765}","it('should be blank for unknown format', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':date[bogus]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 281, 'column': 8, 'index': 8089}","it('should be 1.0 or 1.1', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^1\.[01]$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':http-version', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 287, 'column': 8, 'index': 8252}","it('should be 1.0 or 1.1', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^1\.[01]$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':http-version', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 299, 'column': 8, 'index': 8577}","it('should get request properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'me')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[x-from-string]', { stream: stream }))
          .get('/')
          .set('x-from-string', 'me')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 305, 'column': 8, 'index': 8737}","it('should get request properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'me')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[x-from-string]', { stream: stream }))
          .get('/')
          .set('x-from-string', 'me')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 316, 'column': 8, 'index': 9077}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo=bar, fizz=buzz')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[set-cookie]', { stream: stream }))
          .get('/')
          .set('Set-Cookie', ['foo=bar', 'fizz=buzz'])
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 322, 'column': 8, 'index': 9253}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo=bar, fizz=buzz')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':req[set-cookie]', { stream: stream }))
          .get('/')
          .set('Set-Cookie', ['foo=bar', 'fizz=buzz'])
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 335, 'column': 8, 'index': 9637}","it('should get response properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'true')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':res[x-sent]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 341, 'column': 8, 'index': 9799}","it('should get response properties', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'true')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':res[x-sent]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 351, 'column': 8, 'index': 10094}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 357, 'column': 8, 'index': 10260}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 361, 'column': 8, 'index': 10359}","it('should display all values of array headers', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'foo, bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':res[x-keys]', { stream: stream }, function (req, res, next) {
          res.setHeader('X-Keys', ['foo', 'bar'])
          next()
        })

        request(server)
          .get('/')
          .expect('X-Keys', 'foo, bar')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 375, 'column': 8, 'index': 10763}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 382, 'column': 8, 'index': 10968}","it('should get remote address', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 392, 'column': 8, 'index': 11247}","it('should use req.ip if there', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          req.ip = '10.0.0.1'
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 398, 'column': 8, 'index': 11413}","it('should use req.ip if there', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          req.ip = '10.0.0.1'
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 402, 'column': 8, 'index': 11512}","it('should use req.ip if there', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          req.ip = '10.0.0.1'
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 412, 'column': 8, 'index': 11786}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 419, 'column': 8, 'index': 11991}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 423, 'column': 8, 'index': 12090}","it('should work on https server', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createSecureServer(':remote-addr', { stream: stream })

        request(server)
          .get('/')
          .ca(server.cert)
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 432, 'column': 8, 'index': 12340}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 439, 'column': 8, 'index': 12545}","it('should work when connection: close', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-addr', { stream: stream }))
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 450, 'column': 8, 'index': 12875}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 459, 'column': 8, 'index': 13132}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 463, 'column': 8, 'index': 13231}","it('should work when connection: keep-alive', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, function (req, res, next) {
          delete req._remoteAddress
          next()
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 475, 'column': 8, 'index': 13593}","it('should work when req.ip is a getter', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          Object.defineProperty(req, 'ip', {
            get: function () { return req.connection.remoteAddress ? '10.0.0.1' : undefined }
          })
        })

        request(server)
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 481, 'column': 8, 'index': 13759}","it('should work when req.ip is a getter', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          Object.defineProperty(req, 'ip', {
            get: function () { return req.connection.remoteAddress ? '10.0.0.1' : undefined }
          })
        })

        request(server)
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 485, 'column': 8, 'index': 13858}","it('should work when req.ip is a getter', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '10.0.0.1')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          Object.defineProperty(req, 'ip', {
            get: function () { return req.connection.remoteAddress ? '10.0.0.1' : undefined }
          })
        })

        request(server)
          .get('/')
          .set('Connection', 'close')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 498, 'column': 8, 'index': 14306}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 507, 'column': 8, 'index': 14563}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 511, 'column': 8, 'index': 14662}","it('should not fail if req.connection missing', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(res.text.length > 0)
          assert.strictEqual(line, res.text)

          res.req.connection.destroy()
          server.close(done)
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':remote-addr', { stream: stream }, null, function (req) {
          delete req.connection
        })

        request(server.listen())
          .get('/')
          .set('Connection', 'keep-alive')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 524, 'column': 8, 'index': 15044}","it('should be empty if none present', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 530, 'column': 8, 'index': 15203}","it('should be empty if none present', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 540, 'column': 8, 'index': 15490}","it('should support Basic authorization', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'tj')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 546, 'column': 8, 'index': 15650}","it('should support Basic authorization', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'tj')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 557, 'column': 8, 'index': 15999}","it('should be empty for empty Basic authorization user', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic Og==')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 563, 'column': 8, 'index': 16158}","it('should be empty for empty Basic authorization user', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':remote-user', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic Og==')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 576, 'column': 8, 'index': 16534}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 578, 'column': 10, 'index': 16626}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 579, 'column': 10, 'index': 16657}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 585, 'column': 8, 'index': 16784}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 589, 'column': 8, 'index': 16883}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 597, 'column': 8, 'index': 17106}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 603, 'column': 8, 'index': 17278}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 613, 'column': 8, 'index': 17574}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 619, 'column': 8, 'index': 17746}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 629, 'column': 8, 'index': 18043}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 635, 'column': 8, 'index': 18205}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':response-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 645, 'column': 8, 'index': 18501}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 647, 'column': 10, 'index': 18593}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 648, 'column': 10, 'index': 18624}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 655, 'column': 8, 'index': 18792}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 659, 'column': 8, 'index': 18891}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 668, 'column': 8, 'index': 19140}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 669, 'column': 8, 'index': 19171}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 677, 'column': 8, 'index': 19348}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 683, 'column': 8, 'index': 19507}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 687, 'column': 8, 'index': 19606}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 698, 'column': 8, 'index': 19908}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 704, 'column': 8, 'index': 20067}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 708, 'column': 8, 'index': 20166}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 719, 'column': 8, 'index': 20449}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 725, 'column': 8, 'index': 20608}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 729, 'column': 8, 'index': 20707}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 734, 'column': 8, 'index': 20819}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 750, 'column': 8, 'index': 21181}","it('should get response status', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, String(res.statusCode))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':status', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 756, 'column': 8, 'index': 21359}","it('should get response status', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, String(res.statusCode))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':status', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 766, 'column': 8, 'index': 21644}","it('should not exist before response sent', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':status', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 772, 'column': 8, 'index': 21803}","it('should not exist before response sent', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':status', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 776, 'column': 8, 'index': 21902}","it('should not exist before response sent', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':status', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 787, 'column': 8, 'index': 22161}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 792, 'column': 8, 'index': 22298}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 796, 'column': 8, 'index': 22412}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 803, 'column': 8, 'index': 22596}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 805, 'column': 10, 'index': 22688}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 806, 'column': 10, 'index': 22719}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 812, 'column': 8, 'index': 22846}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 816, 'column': 8, 'index': 22945}","it('should be in milliseconds', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var start = Date.now()

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 824, 'column': 8, 'index': 23165}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 830, 'column': 8, 'index': 23337}","it('should have three digits by default', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{3}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 840, 'column': 8, 'index': 23630}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 846, 'column': 8, 'index': 23802}","it('should have five digits with argument ""5""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+\.[0-9]{5}$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[5]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 856, 'column': 8, 'index': 24096}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 862, 'column': 8, 'index': 24258}","it('should have no digits with argument ""0""', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.ok(/^[0-9]+$/.test(line))
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':total-time[0]', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 872, 'column': 8, 'index': 24547}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 874, 'column': 10, 'index': 24639}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 875, 'column': 10, 'index': 24670}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 882, 'column': 8, 'index': 24838}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 886, 'column': 8, 'index': 24937}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 895, 'column': 8, 'index': 25183}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 896, 'column': 8, 'index': 25214}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 904, 'column': 8, 'index': 25391}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 910, 'column': 8, 'index': 25550}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 914, 'column': 8, 'index': 25649}","it('should be empty without hidden property', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res, next) {
          delete req._startAt
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 925, 'column': 8, 'index': 25948}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 931, 'column': 8, 'index': 26107}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 935, 'column': 8, 'index': 26206}","it('should be empty before response', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', {
          immediate: true,
          stream: stream
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 946, 'column': 8, 'index': 26486}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 952, 'column': 8, 'index': 26645}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 956, 'column': 8, 'index': 26744}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 961, 'column': 8, 'index': 26853}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 977, 'column': 8, 'index': 27208}","it('should get request URL', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/foo')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':url', { stream: stream }))
          .get('/foo')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 983, 'column': 8, 'index': 27370}","it('should get request URL', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/foo')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':url', { stream: stream }))
          .get('/foo')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 993, 'column': 8, 'index': 27654}","it('should use req.originalUrl if exists', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':url', { stream: stream }, function (req, res, next) {
          req.originalUrl = '/bar'
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 999, 'column': 8, 'index': 27816}","it('should use req.originalUrl if exists', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':url', { stream: stream }, function (req, res, next) {
          req.originalUrl = '/bar'
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1003, 'column': 8, 'index': 27915}","it('should use req.originalUrl if exists', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '/bar')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':url', { stream: stream }, function (req, res, next) {
          req.originalUrl = '/bar'
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1014, 'column': 8, 'index': 28217}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 1019, 'column': 8, 'index': 28354}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 1023, 'column': 8, 'index': 28468}","it('should not exist for aborted request', function (done) {
        var stream = createLineStream(function (line) {
          assert.strictEqual(line, '-')
          server.close(done)
        })

        var server = createServer(':status', { stream: stream }, function () {
          test.abort()
        })

        var test = request(server).post('/')
        test.write('0')
      })",steel
/test/morgan.js,Global Variable,"{'line': 1032, 'column': 8, 'index': 28696}","it('should log result of function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1038, 'column': 8, 'index': 28863}","it('should log result of function', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET / 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        function format (tokens, req, res) {
          return [req.method, req.url, res.statusCode].join(' ')
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1052, 'column': 8, 'index': 29264}","it('should not log for undefined return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return undefined
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1066, 'column': 8, 'index': 29638}","it('should not log for null return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return null
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1082, 'column': 8, 'index': 30070}","it('should accept format as format string of tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1088, 'column': 8, 'index': 30233}","it('should accept format as format string of tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'GET /')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer(':method :url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1098, 'column': 8, 'index': 30522}","it('should accept text mixed with tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'method=GET url=/')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('method=:method url=:url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1104, 'column': 8, 'index': 30696}","it('should accept text mixed with tokens', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'method=GET url=/')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('method=:method url=:url', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1114, 'column': 8, 'index': 30992}","it('should accept special characters', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'LOCAL\\tobi ""GET /"" 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('LOCAL\\:remote-user "":method :url"" :status', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dG9iaTpsb2tp')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1120, 'column': 8, 'index': 31173}","it('should accept special characters', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, 'LOCAL\\tobi ""GET /"" 200')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('LOCAL\\:remote-user "":method :url"" :status', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dG9iaTpsb2tp')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1133, 'column': 8, 'index': 31581}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('combined', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1135, 'column': 10, 'index': 31673}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('combined', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1140, 'column': 8, 'index': 31921}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('combined', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1155, 'column': 8, 'index': 32370}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1157, 'column': 10, 'index': 32462}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1162, 'column': 8, 'index': 32682}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d{2}\/\w{3}\/\d{4}:\d{2}:\d{2}:\d{2} \+0000/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 -')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('common', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1175, 'column': 8, 'index': 33045}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1177, 'column': 10, 'index': 33137}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1182, 'column': 8, 'index': 33373}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\w+, \d+ \w+ \d+ \d+:\d+:\d+ \w+/, '_timestamp_')
          assert.strictEqual(masked, res.text + ' - tj [_timestamp_] ""GET / HTTP/1.1"" 200 - ""http://localhost/"" ""my-ua""')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('default', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .set('Referer', 'http://localhost/')
          .set('User-Agent', 'my-ua')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1197, 'column': 8, 'index': 33813}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Global Variable,"{'line': 1204, 'column': 8, 'index': 34080}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Global Variable,"{'line': 1208, 'column': 8, 'index': 34191}","it('should not color 1xx', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 36), '_color_0_GET / _color_0_102_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 102
          next()
        })

        request(server)
          .get('/')
          .expect(102, function (err, res) {
            if (err && err.code === 'ECONNRESET') {
              // finishing response with 1xx is invalid http
              // but node.js server lets the server do this, so
              // morgan needs to test in this condition even if
              // the http client doesn't like it
              err = null
            }
            cb(err, res)
          })
      })",steel
/test/morgan.js,Global Variable,"{'line': 1228, 'column': 8, 'index': 34859}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1235, 'column': 8, 'index': 35127}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1239, 'column': 8, 'index': 35238}","it('should color 2xx green', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_32_200_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 200
          next()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1250, 'column': 8, 'index': 35520}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1257, 'column': 8, 'index': 35788}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1261, 'column': 8, 'index': 35899}","it('should color 3xx cyan', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_36_300_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 300
          next()
        })

        request(server)
          .get('/')
          .expect(300, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1272, 'column': 8, 'index': 36182}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1279, 'column': 8, 'index': 36450}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1283, 'column': 8, 'index': 36561}","it('should color 4xx yelow', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_33_400_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 400
          next()
        })

        request(server)
          .get('/')
          .expect(400, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1294, 'column': 8, 'index': 36842}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1301, 'column': 8, 'index': 37110}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1305, 'column': 8, 'index': 37221}","it('should color 5xx red', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line.substr(0, 37), '_color_0_GET / _color_31_500_color_0_')
          assert.strictEqual(line.substr(-9), '_color_0_')
          done()
        })

        var stream = createColorLineStream(function onLine (line) {
          cb(null, null, line)
        })

        var server = createServer('dev', { stream: stream }, function (req, res, next) {
          res.statusCode = 500
          next()
        })

        request(server)
          .get('/')
          .expect(500, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1317, 'column': 10, 'index': 37588}","it('should not have color or response values', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, '_color_0_GET / _color_0_-_color_0_ - ms - -_color_0_')
            done()
          })

          var stream = createColorLineStream(function onLine (line) {
            cb(null, null, line)
          })

          var server = createServer('dev', {
            immediate: true,
            stream: stream
          })

          request(server)
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 1323, 'column': 10, 'index': 37808}","it('should not have color or response values', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, '_color_0_GET / _color_0_-_color_0_ - ms - -_color_0_')
            done()
          })

          var stream = createColorLineStream(function onLine (line) {
            cb(null, null, line)
          })

          var server = createServer('dev', {
            immediate: true,
            stream: stream
          })

          request(server)
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 1327, 'column': 10, 'index': 37925}","it('should not have color or response values', function (done) {
          var cb = after(2, function (err, res, line) {
            if (err) return done(err)
            assert.strictEqual(line, '_color_0_GET / _color_0_-_color_0_ - ms - -_color_0_')
            done()
          })

          var stream = createColorLineStream(function onLine (line) {
            cb(null, null, line)
          })

          var server = createServer('dev', {
            immediate: true,
            stream: stream
          })

          request(server)
            .get('/')
            .expect(200, cb)
        })",steel
/test/morgan.js,Global Variable,"{'line': 1341, 'column': 8, 'index': 38235}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1343, 'column': 10, 'index': 38327}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1348, 'column': 8, 'index': 38504}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, res.text + ' tj GET / HTTP/1.1 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('short', { stream: stream }))
          .get('/')
          .set('Authorization', 'Basic dGo6')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1361, 'column': 8, 'index': 38863}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1363, 'column': 10, 'index': 38955}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1368, 'column': 8, 'index': 39108}","it('should match expectations', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var masked = line.replace(/\d+\.\d{3} ms/, '_timer_')
          assert.strictEqual(masked, 'GET / 200 - - _timer_')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        request(createServer('tiny', { stream: stream }))
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1381, 'column': 6, 'index': 39437}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1388, 'column': 6, 'index': 39697}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1392, 'column': 6, 'index': 39814}","it('should flush log periodically', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 1000)
        assert.ok(Date.now() - time <= 1100)
        done()
      })
      var server = createServer(':method :url', {
        buffer: true,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1409, 'column': 6, 'index': 40189}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1416, 'column': 6, 'index': 40447}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1420, 'column': 6, 'index': 40563}","it('should accept custom interval', function (done) {
      var cb = after(2, function (err, res, log) {
        if (err) return done(err)
        assert.strictEqual(log, 'GET /first\nGET /second\n')
        assert.ok(Date.now() - time >= 200)
        assert.ok(Date.now() - time <= 300)
        done()
      })
      var server = createServer(':method :url', {
        buffer: 200,
        stream: { write: writeLog }
      })
      var time = Date.now()

      function writeLog (log) {
        cb(null, null, log)
      }

      request(server)
        .get('/first')
        .expect(200, function (err) {
          if (err) return cb(err)
          request(server)
            .get('/second')
            .expect(200, cb)
        })
    })",steel
/test/morgan.js,Global Variable,"{'line': 1439, 'column': 6, 'index': 40994}","it('should not have value for :res', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1445, 'column': 6, 'index': 41149}","it('should not have value for :res', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1449, 'column': 6, 'index': 41242}","it('should not have value for :res', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1460, 'column': 6, 'index': 41505}","it('should not have value for :response-time', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :response-time', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1466, 'column': 6, 'index': 41660}","it('should not have value for :response-time', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :response-time', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1470, 'column': 6, 'index': 41753}","it('should not have value for :response-time', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :response-time', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1481, 'column': 6, 'index': 42011}","it('should not have value for :status', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :status', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1487, 'column': 6, 'index': 42166}","it('should not have value for :status', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :status', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1491, 'column': 6, 'index': 42259}","it('should not have value for :status', function (done) {
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        cb(null, null, line)
      })

      var server = createServer(':method :url :status', {
        immediate: true,
        stream: stream
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1502, 'column': 6, 'index': 42503}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1503, 'column': 6, 'index': 42532}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1509, 'column': 6, 'index': 42687}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1514, 'column': 6, 'index': 42806}","it('should log before response', function (done) {
      var lineLogged = false
      var cb = after(2, function (err, res, line) {
        if (err) return done(err)
        assert.strictEqual(line, 'GET / -')
        done()
      })

      var stream = createLineStream(function (line) {
        lineLogged = true
        cb(null, null, line)
      })

      var server = createServer(':method :url :res[x-sent]', { immediate: true, stream: stream }, function (req, res, next) {
        assert.ok(lineLogged)
        next()
      })

      request(server)
        .get('/')
        .expect(200, cb)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1527, 'column': 6, 'index': 43178}","it('should be able to skip based on request', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req) {
        return req.url.indexOf('skip=true') !== -1
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/?skip=true')
        .set('Connection', 'close')
        .expect(200, done)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1542, 'column': 6, 'index': 43620}","it('should be able to skip based on response', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req, res) {
        return res.statusCode === 200
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/')
        .expect(200, done)
    })",steel
/test/morgan.js,Global Variable,"{'line': 1573, 'column': 8, 'index': 44542}","it('should compile a string into a function', function () {
        var fn = morgan.compile(':method')
        assert.ok(typeof fn === 'function')
        assert.ok(fn.length === 3)
      })",steel
/test/morgan.js,Global Variable,"{'line': 1582, 'column': 2, 'index': 44718}",Unknown,steel
/test/morgan.js,Global Variable,"{'line': 1583, 'column': 2, 'index': 44744}",Unknown,steel
/test/morgan.js,Global Variable,"{'line': 1609, 'column': 2, 'index': 45303}",Unknown,steel
/test/morgan.js,Global Variable,"{'line': 1610, 'column': 2, 'index': 45339}",Unknown,steel
/test/morgan.js,Global Variable,"{'line': 1634, 'column': 2, 'index': 45891}",Unknown,steel
/test/morgan.js,Global Variable,"{'line': 1635, 'column': 2, 'index': 45972}",Unknown,steel
/test/morgan.js,Sleepy Test,"{'line': 663, 'column': 10, 'index': 19048}","it('should not include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms < end - start + 1)
          assert(ms < write - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':response-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Sleepy Test,"{'line': 735, 'column': 10, 'index': 20882}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':response-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Sleepy Test,"{'line': 890, 'column': 10, 'index': 25091}","it('should include response write time', function (done) {
        var cb = after(2, function (err, res, line) {
          if (err) return done(err)
          var end = Date.now()
          var ms = parseFloat(line)
          assert(ms > 0)
          assert(ms > write - start - 1)
          assert(ms < end - start + 1)
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var server = createServer(':total-time', { stream: stream }, function (req, res) {
          res.write('hello, ')
          write = Date.now()

          setTimeout(function () {
            res.end('world!')
          }, 50)
        })

        var start = Date.now()
        var write = null

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Sleepy Test,"{'line': 962, 'column': 10, 'index': 26916}","it('should be empty if morgan invoked after response sent', function (done) {
        var cb = after(3, function (err, res, line) {
          if (err) return done(err)
          assert.strictEqual(line, '-')
          done()
        })

        var stream = createLineStream(function (line) {
          cb(null, null, line)
        })

        var logger = morgan(':total-time', {
          immediate: true,
          stream: stream
        })

        var server = http.createServer(function (req, res) {
          setTimeout(function () {
            logger(req, res, cb)
          }, 10)

          res.end()
        })

        request(server)
          .get('/')
          .expect(200, cb)
      })",steel
/test/morgan.js,Unknown Test,"{'column': 6, 'line': 1051}","it('should not log for undefined return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return undefined
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Unknown Test,"{'column': 6, 'line': 1065}","it('should not log for null return', function (done) {
        var stream = createLineStream(function () {
          throw new Error('should not log line')
        })

        function format (tokens, req, res) {
          return null
        }

        request(createServer(format, { stream: stream }))
          .get('/')
          .expect(200, done)
      })",steel
/test/morgan.js,Unknown Test,"{'column': 4, 'line': 1526}","it('should be able to skip based on request', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req) {
        return req.url.indexOf('skip=true') !== -1
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/?skip=true')
        .set('Connection', 'close')
        .expect(200, done)
    })",steel
/test/morgan.js,Unknown Test,"{'column': 4, 'line': 1541}","it('should be able to skip based on response', function (done) {
      var stream = createLineStream(function () {
        throw new Error('should not log line')
      })

      function skip (req, res) {
        return res.statusCode === 200
      }

      request(createServer({ format: 'default', skip: skip, stream: stream }))
        .get('/')
        .expect(200, done)
    })",steel
